# DELoc System Diagrams

## Core Architecture Diagram (ASCII)

```
                           ┌─ DELoc CLI Tool ─┐
                           │  Single Binary   │
                           │     <5MB         │
                           └─────────┬────────┘
                                     │
                      ┌──────────────┼──────────────┐
                      │              │              │
              ┌───────▼────┐  ┌──────▼──────┐  ┌───▼────┐
              │  Command   │  │    Core     │  │ Plugin │
              │  Router    │  │   Engine    │  │System  │
              └───────┬────┘  └──────┬──────┘  └───┬────┘
                      │              │              │
           ┌──────────┼──────────────┼──────────────┼──────────┐
           │          │              │              │          │
    ┌──────▼───┐ ┌────▼────┐ ┌───────▼───┐ ┌────────▼───┐ ┌───▼───┐
    │   Init   │ │ Deploy  │ │  Status   │ │   Stop     │ │ Scale │
    └──────────┘ └────┬────┘ └───────────┘ └────────────┘ └───────┘
                      │
              ┌───────▼────────────────────────┐
              │         Core Engine            │
              │ ┌──────────┬──────────────────┐ │
              │ │Config    │Service  │Resource│ │
              │ │Manager   │Registry │Manager │ │
              │ └──────────┴──────────────────┘ │
              └───────┬────────────────────────┘
                      │
          ┌───────────┼───────────┐
          │           │           │
    ┌─────▼─────┐ ┌───▼───┐ ┌─────▼─────┐
    │  Docker   │ │Future │ │Kubernetes │
    │ Adapter   │ │Adapter│ │ Adapter   │
    └─────┬─────┘ └───┬───┘ └─────┬─────┘
          │           │           │
    ┌─────▼─────┐ ┌───▼───┐ ┌─────▼─────┐
    │  Docker   │ │ Other │ │    K8s    │
    │  Engine   │ │Infra  │ │  Cluster  │
    └───────────┘ └───────┘ └───────────┘
```

## Resource Optimization Flow

```
User Input
    │
    ▼
┌─────────────────────┐
│ Resource Detection  │ ◄─── System Calls
│ - CPU, Memory, Disk │      /proc/*, statvfs
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐
│  Service Analysis   │ ◄─── Service Definitions
│ - Requirements      │      YAML Templates
│ - Dependencies      │
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐
│ Allocation Engine   │ ◄─── Bin Packing Algorithm
│ - Memory Mapping    │      CPU Affinity
│ - Resource Limits   │      Load Balancing
└─────────┬───────────┘
          │
          ▼
┌─────────────────────┐
│ Deployment Config   │ ───► Docker Compose
│ - Optimized Limits  │      Helm Values
│ - Profile Settings  │      Resource Quotas
└─────────────────────┘
```

## Service Lifecycle State Machine

```
                     [deploy]
    ┌─────────┐ ─────────────► ┌─────────────┐
    │ STOPPED │                │ DEPLOYING   │
    └─────────┘ ◄────────────── └─────────────┘
         ▲          [stop]              │
         │                              │ [success]
         │                              ▼
         │                     ┌─────────────┐     [scale]
         │            [failed] │   RUNNING   │ ────────────┐
         │        ┌─────────── └─────────────┘             │
         │        │                    │                   │
         │        ▼                    │ [health_fail]     ▼
         │  ┌─────────────┐            ▼             ┌─────────────┐
         └──│   FAILED    │   ┌─────────────┐        │  SCALING    │
            └─────────────┘   │  UNHEALTHY  │        └─────────────┘
                   │          └─────────────┘              │
                   │               │                       │
                   └───────────────┼───────────────────────┘
                      [cleanup]    │    [cleanup]
                                   ▼
                            ┌─────────────┐
                            │  CLEANUP    │
                            └─────────────┘
```

## Memory Management Architecture

```
┌──────────────────────────────────────────────────────────────┐
│                    System Memory (Total)                    │
├──────────────────────────────────────────────────────────────┤
│ OS Reserved (20%)  │ DELoc Core (<10MB) │ Available (75-80%) │
└──────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌──────────────────────────────────────────────────────────────┐
│                 Available Memory Pool                       │
├──────────────────────────────────────────────────────────────┤
│           Service Memory Allocation                         │
│  ┌──────────┬──────────┬──────────┬──────────┬──────────┐   │
│  │ Kafka    │ Spark    │ MinIO    │ Postgres │ Buffer   │   │
│  │ 256MB    │ 512MB    │ 128MB    │ 256MB    │ 128MB    │   │
│  └──────────┴──────────┴──────────┴──────────┴──────────┘   │
├──────────────────────────────────────────────────────────────┤
│                  Safety Margin (10%)                        │
└──────────────────────────────────────────────────────────────┘
```

## Plugin Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    Plugin Registry                         │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │   Docker    │ Kubernetes  │   Podman    │   Custom    │ │
│  │   Plugin    │   Plugin    │   Plugin    │   Plugin    │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 Plugin Interface                           │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ Initialize() | Deploy() | Stop() | Status() | Scale() │ │
│ │ Health() | Logs() | Update() | Backup() | Cleanup()   │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                Target Infrastructure                       │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐ │
│  │   Docker    │    K8s      │   Cloud     │    Edge     │ │
│  │   Engine    │  Cluster    │ Platforms   │ Devices     │ │
│  └─────────────┴─────────────┴─────────────┴─────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## Network Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                     Host Network                           │
├─────────────────────────────────────────────────────────────┤
│                  DELoc Bridge Network                      │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ Service Discovery & Internal Communication         │   │
│  │  ┌──────────┬──────────┬──────────┬──────────┐      │   │
│  │  │  Kafka   │  Spark   │  MinIO   │ Postgres │      │   │
│  │  │ :9092    │ :8080    │ :9000    │ :5432    │      │   │
│  │  └──────────┴──────────┴──────────┴──────────┘      │   │
│  └─────────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│                Port Mapping to Host                        │
│ Host:9092 ──► Kafka:9092   │ Host:8080 ──► Spark:8080     │
│ Host:9000 ──► MinIO:9000   │ Host:5432 ──► Postgres:5432  │
└─────────────────────────────────────────────────────────────┘
```

## Error Handling Flow

```
User Command
     │
     ▼
┌─────────────┐
│ Validation  │ ───► [Invalid Input] ───► User Error Message
└─────────────┘
     │ [Valid]
     ▼
┌─────────────┐
│  Execution  │ ───► [Error] ───► ┌─────────────┐
└─────────────┘                   │Error Handler│
     │ [Success]                  └─────────────┘
     ▼                                   │
┌─────────────┐                          ▼
│   Result    │                   ┌─────────────┐
│ Formatting  │                   │   Cleanup   │
└─────────────┘                   │ & Rollback  │
     │                            └─────────────┘
     ▼                                   │
User Success Message                     ▼
                              Detailed Error Report
```